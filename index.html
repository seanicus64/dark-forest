<!DOCTYPE html>
<html>
<head>
</head>
<body>
<p id="status">hello world</p>
<canvas id="canvas" width=1200 height=1200>hello world</canvas>
<script> 
document.getElementById("status").innerHTML = "HELLO WRLD";
var status_ = document.getElementById("status");

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
ctx.fillStyle = "black";
ctx.fillRect(0, 0, canvas.width, canvas.height);
//let socket = new WebSocket("wss://javascript.info/article/websocket/demo/hello");
let socket = new WebSocket("ws://127.0.0.1:9000")
socket.onopen = function(e) {
    //alert("connection established");
    //alert("sending to server");
    console.log("connection established");
    console.log("sending to server");

    socket.send("cucumber");
    };
//var celestial = {
//    id
//    x
//    y
//    radius
//    color
//    is_star
//
//}
function Celestial(id, x, y, radius, color, is_star) {
    this.id = id;
    this.x = x;
    this.y = y;
    this.radius = radius;
    this.color = color;
    this.is_star = is_star;
    this.fruit = "banana";
}
var star_data;
function redraw(){
    console.log("sssssssss");
    console.log(allstars);
    console.log(canvas.width);
    console.log(canvas.height);
    var pixel_height = Math.floor(10000000000000 / canvas.height);
    var pixel_width = Math.floor(10000000000000 / canvas.width);
    console.log(pixel_height);
    console.log(pixel_width);
    console.log("sssssssss");
    var x;
    var y;

    allstars.forEach(function(star){
        x = Math.floor(star.x / pixel_width);
        y = Math.floor(star.y / pixel_height);
        
        console.log(x);
        make_star(x, y, star.id, star.color);
            
    });
    

}
function create_stars() {
    console.log("tttttttT");
    console.log(starlist);

    console.log("tttttttT");
    var innerstring = starlist[1];
    innerstring += starlist[1][1];
    status_.innerHTML = innerstring;
    starlist.forEach(function (star){
        var celestial = new Celestial(star[0], star[1], star[2], star[3], star[4], star[5]);
        allstars.push(celestial);
        //console.log(celestial.y);
    });

}
function foo (){
    console.log("yyyyyyyyyyyyyY");
    console.log(this.banana);
    banana = 30;
    console.log(banana);
    console.log("zzzzzzzzzzzzzz");
}
var starlist;
var banana;// = 43;
var allstars = [];
console.log(typeof(allstars));
console.log(banana);
console.log(this.banana);

foo();
console.log("llllllllllll");
console.log(banana);
console.log("mmmmmmmmmmmmm");
socket.onmessage = function(event) {
    console.log(banana);
    console.log("kkkkkkkkkkkk");
    message = `[message] Data received from server: ${event.data}`;
    star_data = JSON.parse(event.data);
    starlist = star_data["ITEMS"];
    console.log("pppppppppp");
    console.log(starlist);
    console.log("ppppppppp");
    switch(star_data["MESSAGE_TYPE"]){
        case "STAR_LIST":
        {
            console.log("it's a starlist");
            create_stars();
            redraw();
            break;
        }


    }

//    console.log(thing["MESSAGE_TYPE"]);
//    status_.innerHTML = thing["MESSAGE_TYPE"];
//    console.log(star_data);
    
//    console.log(message);
//    status_.innerHTML = message;
    };
socket.onclose = function(event) {
    if (event.wasClean) {
        alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
    } else {
        alert('[close] connection died');
    }
};

socket.onerror = function(error) {
    alert(`[error] ${error.message}`);
    };







var x, y;
var purple, blue, red, yellow, orange, red, white;
purple = [255, 255, 0];
var color_dict = {
    test:   [255,   128,0 ,        255],

    blue:   [  0,   0, 255,        255],
    green:  [  0, 255,   0,        255],
    teal:   [  0, 255, 255,        255],
    red:    [255,   0,   0,        255],
    purple: [255,   0, 255,        255],
    yellow: [255, 255,   0,        255],
    white:  [255, 255, 255,        255],
    orange: [255, 127,   0,        255],


}

function make_star(x, y, i, color){
    console.log(color);
    console.log(i);
    ctx.fillStyle = color;
    color = color_dict[color];
    console.log(color);
    d[0] = color[0];
    d[1] = color[1];
    d[2] = color[2];
    d[3] = color[3];

    ctx.putImageData(image_data, x, y);
    }

var x = 0;
var y = 0;
var number_of_stars = 5000;
var i = 0;
var image_data = ctx.createImageData(1, 1);
var d = image_data.data;
d[0] = 255;
d[1] = 255;
d[2] = 0;
d[3] = 255;
number_of_stars = 0;
while (i <= number_of_stars)
{   
    x = Math.random() * 500;
    y = Math.random() * 500;
    

    
    make_star(x, y, i);
    //x++;
    //if (x == 500)
    //{
    //    x = 0;
    //    y++;
    //}
    i++;
}
make_star(x, y);



</script>
</body>
</html>
